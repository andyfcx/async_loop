name: SemVer

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

env:
  registry: "docker.io"
  reponame: "async_loop"

jobs:
    build:
      runs-on: ubuntu-latest
      steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Get Branch Name
        run: echo "BRANCH=${GITHUB_REF##*/}" >> $GITHUB_ENV

      - uses: actions-ecosystem/action-get-latest-tag@v1
        id: get-latest-tag

      - uses: actions-ecosystem/action-bump-semver@v1
        id: bump-semver
        with:
          current_version: ${{ steps.get-latest-tag.outputs.tag }}
          level: minor

      - uses: actions-ecosystem/action-push-tag@v1
        with:
          tag: ${{ steps.bump-semver.outputs.new_version }}
          message: '${{ steps.bump-semver.outputs.new_version }}: PR #${{ github.event.pull_request.number }} ${{ github.event.pull_request.title }}'

      - name: Get Image Tag
        run: echo "${{ steps.bump-semver.outputs.new_version }}"
        # run: echo "${{ env.registry }}/${{ env.reponame }}:${{ env.BRANCH }}-${{ steps.versioning.outputs.version }}"